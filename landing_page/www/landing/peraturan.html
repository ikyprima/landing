<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Service Details - Passion Bootstrap Template</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="/assets/landing_page/img/favicon/android-chrome-192x192.png" rel="icon">
  <link href="/assets/landing_page/img/favicon/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/assets/landing_page/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/landing_page/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/assets/landing_page/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="/assets/landing_page/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="/assets/landing_page/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Passion
  * Template URL: https://bootstrapmade.com/passion-bootstrap-template/
  * Updated: Jul 21 2025 with Bootstrap v5.3.7
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="service-details-page">

  <header id="header" class="header fixed-top">

    <div class="topbar d-flex align-items-center dark-background">
      <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="contact-info d-flex align-items-center">
          <i class="bi bi-envelope d-flex align-items-center"><a href="mailto:contact@example.com">petikesra@gmail.com</a></i>
          <i class="bi bi-phone d-flex align-items-center ms-4"><span>0751-7051536</span></i>
        </div>
        <div class="social-links d-none d-md-flex align-items-center">
          <a href="#" aria-label="Twitter" role="link" class="twitter"><i class="bi bi-twitter-x"></i></a>
          <a href="#" aria-label="Facebook" role="link" class="facebook"><i class="bi bi-facebook"></i></a>
          <a href="#" aria-label="Instagram" role="link" class="instagram"><i class="bi bi-instagram"></i></a>
          <a href="#" aria-label="Linkedin" role="link" class="linkedin"><i class="bi bi-linkedin"></i></a>
        </div>
      </div>
    </div><!-- End Top Bar -->

    <div class="branding d-flex align-items-cente">

      <div class="container position-relative d-flex align-items-center justify-content-between">
        <a href="index.html" class="logo d-flex align-items-center">
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <h1 class="sitename">PETIKESRA</h1>
          <img src="/assets/landing_page/img/logo.webp" id="logo" alt="" >
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="#home" class="active">Beranda</a></li>
            <li><a href="#about">Tentang</a></li>
            <li><a href="#webinar">Webinar</a></li>
            <li><a href="#selflearning">Self Learning</a></li>
            <li><a href="#peraturan">Peraturan</a></li>
            <li><a href="#faq">FAQ</a></li>
            <li><a href="#contact">Kontak</a></li>

            {% if frappe.session.user != "Guest" %}

              <li class="dropdown">
                <a class="bi bi-chevron-down toggle-dropdown" href="#">
                  <img src="{% if user_image %}{{ user_image }}{% else %}/assets/frappe/images/default-avatar.png{% endif %}"
                      alt="User Avatar" class="rounded-circle me-2" width="30" height="30">
                  {{ user_fullname }}
                </a>
                <ul>
                  <li><a class="dropdown-item" href="/lms/user/{{ username }}">Profil Saya</a></li>
                  <li><a class="dropdown-item" href="/lms">Dashboard</a></li>
                  <li><hr></li>
                  <li><a class="dropdown-item" href="/?cmd=web_logout">Logout</a></li>
                </ul>
              </li>
              {% else %}
              <li><a href="/login">Login</a></li>
            {% endif %}

          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

      </div>

    </div>

  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title dark-background" style="background-image: url(/assets/landing_page/img/bg/bg-14.webp);">
      <div class="container position-relative">
        <h1>Dokumen</h1>
        <p>List Peraturan dan Undang-undang </p>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="/#peraturan">Home</a></li>
            <li class="current">Dokumen</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Service Details Section -->
    <section id="service-details" class="service-details section">

      <div class="container">

        <div class="row gy-2">

          <div class="col-lg-8">
            
            <div class="service-content">
              
              <div class="service-features">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <input type="text" id="searchInput" class="form-control " placeholder="Cari Dokumen...">
                
                </div>
                <div class="col-md-6 mb-3">
                  <button id="resetSearch" class="btn btn-success ">Reset Pencarian</button>
                
                </div>
              </div>
                
                  <div id="barang-list" class="row gy-3"></div>
              
                
                <!-- pagination -->
                <div class="row gy-3 text-center mt-2">
                  <div id="pagination" class="mt-3"></div>
                </div>
                
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="service-sidebar">

              <div class="service-menu">
                <h4>Jenis Dokumen</h4>
                <div class="menu-list">
                  <a href="#" class="menu-item active" data-kategori="">
                    <i class="bi bi-arrow-right"></i>
                    <span>Semua Kategori</span>
                  </a>
                  <a href="#" class="menu-item" data-kategori="UU">
                    <i class="bi bi-arrow-right"></i>
                    <span>Undang-undang</span>
                  </a>
                  <a href="#" class="menu-item" data-kategori="PP">
                    <i class="bi bi-arrow-right"></i>
                    <span>Peraturan Presiden</span>
                  </a>
                  <a href="#" class="menu-item" data-kategori="Perda">
                    <i class="bi bi-arrow-right"></i>
                    <span>Peraturan Daerah</span>
                  </a>
                  <a href="#" class="menu-item" data-kategori="Pergub">
                    <i class="bi bi-arrow-right"></i>
                    <span>Peraturan Gubernur</span>
                  </a>
                  <a href="#" class="menu-item" data-kategori="PMK">
                    <i class="bi bi-arrow-right"></i>
                    <span>Peraturan Mentri Keuangan</span>
                  </a>
                  <a href="#" class="menu-item" data-kategori="Permendagri">
                    <i class="bi bi-arrow-right"></i>
                    <span>Peraturan Mentri Dalam Negeri</span>
                  </a>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    </section><!-- /Service Details Section -->

  </main>
 


    <!-- Modal Bootstrap -->
<<div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered" style="max-width:90vw;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pdfModalLabel">Lihat Dokumen</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
      </div>
      <div class="modal-body p-0">
        <iframe id="pdfFrame" src="" style="width:100%; height:80vh; border:none;"></iframe>
      </div>
    </div>
  </div>
</div>
    

  <footer id="footer" class="footer position-relative dark-background">

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-5 col-md-12 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">PETIKESRA</span>
          </a>
          <p>“Membangun Literasi Keuangan Daerah Terintegrasi”</p>
          <div class="social-links d-flex mt-4">
            <a href="" aria-label="Twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
            <a href="" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            <a href="" aria-label="Linkedin"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Link Terkait</h4>
          <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#about">About us</a></li>
            <li><a href="#">Terms of service</a></li>
            <li><a href="#">Privacy policy</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Fitur</h4>
          <ul>
            <li><a href="#">Webinar</a></li>
            <li><a href="#">Self Learning</a></li>
            <li><a href="#">Peraturan</a></li>
            <li><a href="#">Undang-undang</a></li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
          <h4>Kontak Kami</h4>
          <p>Jl. Khatib Sulaiman No.43, Lolong Belanti,</p>
          <p>Kec. Padang Utara, Kota Padang, Sumatera Barat</p>
          <p>Indonesia</p>
          <p class="mt-4"><strong>Telp:</strong> <span>0751-7051536</span></p>
          <p><strong>Email:</strong> <span>petikesra@gmail.com</span></p>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">PETIKESRA</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you've purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>

  </footer>
  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>

  <!-- Vendor JS Files -->
  <script src="/assets/landing_page/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/landing_page/vendor/php-email-form/validate.js"></script>
  <script src="/assets/landing_page/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="/assets/landing_page/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="/assets/landing_page/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="/assets/landing_page/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="/assets/landing_page/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <script src="/assets/landing_page/js/main.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const kategoriParam = urlParams.get("kategori") || "";
    const searchParam   = urlParams.get("search") || "";

    // --- aktifkan kategori sesuai URL ---
    const menuItems = document.querySelectorAll(".menu-item");
   


  menuItems.forEach(item => {
     if (item.dataset.kategori === kategoriParam) {
        item.classList.add("active");
      } else if (!kategoriParam && item.dataset.kategori === "") {
        item.classList.add("active"); 
      } else {
        item.classList.remove("active");
      }
  item.addEventListener("click", (e) => {
    e.preventDefault();
    const kategori = item.dataset.kategori;
    const search = document.getElementById("searchInput").value.trim();
    const params = new URLSearchParams();

    if (kategori) params.set("kategori", kategori);
    if (search) params.set("search", search);

    // update URL tanpa reload halaman
    history.pushState(null, '', '?' + params.toString());

    // update aktif kelas menu
    menuItems.forEach(i => i.classList.remove("active"));
    item.classList.add("active");

    // load data baru sesuai params
    loadData(1); // reset ke halaman 1 saat filter berubah
  });
});

  window.addEventListener('popstate', () => {
    const params = new URLSearchParams(window.location.search);
    const kategoriParam = params.get("kategori") || "";
    const searchParam = params.get("search") || "";

    document.getElementById("searchInput").value = searchParam;

    menuItems.forEach(item => {
      if (item.dataset.kategori === kategoriParam) {
        item.classList.add("active");
      } else if (!kategoriParam && item.dataset.kategori === "") {
        item.classList.add("active");
      } else {
        item.classList.remove("active");
      }
    });

    loadData(1);
  });

  // --- isi search box dari URL ---
  document.getElementById("searchInput").value = searchParam;

  // tekan Enter pada search input → reload halaman dengan kategori + search
  document.getElementById("searchInput").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      const activeKategori = document.querySelector(".menu-item.active").dataset.kategori;
      const search = this.value.trim();
      const params = new URLSearchParams();
      if (activeKategori) params.set("kategori", activeKategori);
      if (search) params.set("search", search);
      window.location.search = params.toString();
    }
  });

  document.getElementById("resetSearch").addEventListener("click", () => {
    // Kosongkan input search
    document.getElementById("searchInput").value = "";
    
    // Set kategori default (Semua Kategori)
    menuItems.forEach(item => {
      if (item.dataset.kategori === "") {
        item.classList.add("active");
      } else {
        item.classList.remove("active");
      }
    });

    // Update URL tanpa reload, set kategori kosong dan search kosong
    const params = new URLSearchParams();
    // kosongkan semua parameter supaya default load
    history.pushState(null, '', window.location.pathname);

    // Load ulang data halaman 1
    loadData(1);
  });

  // --- contoh fetch API dengan kategori & search ---
  let allData = [];
  let currentPage = 1;
  function loadData(page = 1) {
   
    currentPage = page;
    const params = new URLSearchParams(window.location.search);
    params.set("page", page); // set page parameter pada API

    fetch(`https://bpkad.sumbarprov.go.id/layanan-bpkad/api/v1/data-dokumen?${params.toString()}`)
      .then(res => res.json())
      .then(data => {
        
          allData = data.data; // simpan untuk filter pencarian
          renderList(allData);
          let pagination = document.getElementById('pagination');
          pagination.innerHTML = "";
          data.links.forEach(link => {
            if (link.url) {
              let pageNum = getPageNumber(link.url);
              pagination.innerHTML += `
                <button onclick="loadData(${pageNum})"
                  class="btn btn-sm ${link.active ? 'btn-success' : 'btn-outline-success'} m-1">
                  ${link.label}
                </button>
              `;
            }
          });
      });
  }
  

    function renderList(items) {
      let list = document.getElementById('barang-list');
      list.innerHTML = "";
      if (items.length === 0) {
        list.innerHTML = `<div class="col-12"><p class="text-center text-muted">Data tidak ditemukan.</p></div>`;
        return;
      }
      items.forEach(data => {
        list.innerHTML += `
          <div class="col-md-6">
            <div class="feature-item p-3 border rounded shadow-sm h-100">
              <div class="feature-icon mb-2">
                <i class="bi bi-file-earmark-pdf-fill fs-3 text-success"></i>
              </div>
              <div class="feature-content " style="cursor:pointer;" onclick="onItemClick('${data.filepath}')">
                <h5>${data.title_file}</h5>
                <p>${data.description ?? ''}</p>
              </div>
            </div>
          </div>
        `;
      });
    }

    function onItemClick(id) {
      fetch(`https://bpkad.sumbarprov.go.id/layanan-bpkad/api/v1/data-preview-file?path_file=${id}`)
      .then(res => res.json())
      .then(data => {


          const pdfFrame = document.getElementById('pdfFrame');
          const modalEl = document.getElementById('pdfModal');

          pdfFrame.src = data.url;

          // Inisialisasi modal Bootstrap dan buka modal
            const modal = new bootstrap.Modal(modalEl);
            modalEl.addEventListener('hide.bs.modal', () => {
              if (document.activeElement instanceof HTMLElement) {
                document.activeElement.blur();
              }
            }, { once: true });

            modal.show();

            modalEl.addEventListener('hidden.bs.modal', () => {
              pdfFrame.src = '';
            }, { once: true });
      
      });
  
    }

    // Ambil nomor halaman dari URL (Laravel pagination link)
    function getPageNumber(url) {
        let params = new URL(url).searchParams;
        return params.get("page");
    }

      loadData();




  </script>
</body>

</html>